<h1 id="installing-thetis-on-archer2">Installing Thetis on Archer2</h1>
<p>The following are instructions that were valid as of 19/02/26. Please
contact me on Slack if things are no longer working.</p>
<p>The general workflow is:</p>
<ol type="1">
<li><p>Login to Archer2 and copy zip file from local PC.</p></li>
<li><p>Edit and move relevant files to the work directory
(firedrake-configure, constraints.txt, both slurm files)</p></li>
<li><p>Run <code>sh petsc_install.sh</code></p></li>
<li><p>In the work directory, run <code>sbatch petsc_check.slurm</code>
and ensure it passes (ignoring errors due to busy nodes)</p></li>
<li><p>Run <code>sh firedrake_install.sh</code></p></li>
<li><p>In the work directory, run
<code>sbatch firedrake_check.slurm</code> and ensure it passes the
<code>firedrake-check</code></p></li>
<li><p>Activate the Firedrake python environment and install Thetis with
pip.</p></li>
</ol>
<h2 id="archer2-access">Archer2 Access</h2>
<p><em>If you already have access to Archer2, you can ignore this
step.</em></p>
<p>Gaining access to Archer2 may be the longest step but there is an
allocation for Edinburgh researchers.</p>
<p>The documentation and method of requesting access is here: <a
href="https://www.archer2.ac.uk/support-access/access.html">Archer2 -
Getting Access</a></p>
<h2 id="login-to-archer2">Login to Archer2</h2>
<p>SSH into Archer2 with the account you have been provided. Follow
instructions here: <a
href="https://docs.archer2.ac.uk/user-guide/connecting-totp/">Archer2 -
Docs</a>. The account that you get will be assigned a particular
<code>project</code> and <code>username</code>, relevant for later.</p>
<p>For me, after setting up SSH keys, this is:
<code>ssh sjackson@login.archer2.ac.uk</code></p>
<h2 id="moving-files">Moving Files</h2>
<p>In a separate terminal, you will copy over the downloaded zip file
using <code>scp</code> (Secure Copy).</p>
<p><code>scp thetis_installation.zip &lt;username&gt;@login.archer2.ac.uk:/home/&lt;project&gt;/&lt;project&gt;/&lt;username&gt;</code></p>
<p><strong>Important:</strong> Some of these files have variables that
must be changed to adapt for your system.</p>
<p>Unzip this file and you have to move certain files to your work
directory:</p>
<pre><code>export WORK_DIR=/work/&lt;project&gt;/&lt;project&gt;/&lt;username&gt;
mv thetis_installation/constraints.txt $WORK_DIR
mv thetis_installation/firedrake-configure-2025.10.2 $WORK_DIR
mv thetis_installation/firedrake_check.slurm $WORK_DIR
mv thetis_installation/petsc_check.slurm $WORK_DIR
mv thetis_installation/thetis_example.slurm $WORK_DIR</code></pre>
<h2 id="petsc-install">PETSc Install</h2>
<p>Edit the <code>petsc_install.sh</code> file and change the variable
<code>BUILD_DIR</code> to include your project and username.</p>
<p>Then, run the file <code>sh petsc_install.sh</code>.</p>
<h3 id="petsc-check">PETSc Check</h3>
<p>To ensure that PETSc is installed correctly, we will run the
<code>petsc_check.slurm</code> script from our work directory.</p>
<p>Firstly, we must update the lines:</p>
<pre><code>#SBATCH --account=&lt;project&gt;
BUILD_DIR</code></pre>
<p>In the SBATCH case, <code>&lt;project&gt;</code> refers to your
account budget code, which you can find on SAFE (refer to docs: <a
href="https://docs.archer2.ac.uk/faq/#checking-budgets">Archer2 - Budget
Code</a>)</p>
<p>Then, run the script with <code>sbatch petsc_check.slurm</code>.</p>
<h2 id="firedrake-install">Firedrake Install</h2>
<p>This is following instructions from <a
href="https://www.firedrakeproject.org/install.html#install-firedrake">Firedrake
- Install</a>, including a current setuptools issue fix, with our
constraints.txt file.</p>
<p>Edit the <code>firedrake_install.sh</code> file and change the
variable <code>BUILD_DIR</code> to include your project and
username.</p>
<p>Then, run the file <code>sh firedrake_install.sh</code>.</p>
<h3 id="firedrake-check">Firedrake Check</h3>
<p>To ensure that Firedrake is installed correctly, we will run the
<code>firedrake_check.slurm</code> script from our work directory.</p>
<p>Firstly, we must update the lines:</p>
<pre><code>#SBATCH --account=&lt;project&gt;
BUILD_DIR</code></pre>
<p>In the SBATCH case, <code>&lt;project&gt;</code> refers to your
account budget code, just like the PETSC <code>petsc_check.slurm</code>
file.</p>
<p>Then, run the script with <code>sbatch firedrake_check.slurm</code>.
## Thetis Install</p>
<p>To install Thetis, you must activate the generated Firedrake python
environment and then you can install Thetis as normal as per website: <a
href="https://thetisproject.org/download.html#installing-thetis">Thetis
- Installation</a> (but make sure this is completed in the work
directory).</p>
<p>I would suggest installing the editable version as it comes with the
examples:</p>
<pre><code>cd $WORK_DIR
git clone https://github.com/thetisproject/thetis
cd thetis
git checkout v2025.10.1
pip install -e .</code></pre>
<h3 id="thetis-example">Thetis Example</h3>
<p>Using the supplied <code>thetis_example.slurm</code> script, you can
submit jobs. It must be edited for the desired Thetis simulation that
you wish to run and be placed within the right directory.</p>
